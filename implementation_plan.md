# 开发计划

## 概述
项目：零部件采购成本与机会分析系统 (PCO-BI)
预计周期：6周
当前状态：[x] 已确认 / [ ] 执行中 / [ ] 已完成

## 技术方案

| 层级 | 技术选择 | 原因 |
|-----|---------|------|
| **前端** | React (Vite) + Ant Design + ECharts | React生态丰富；AntD符合B端商务UI规范；ECharts对气泡图和复杂交互支持最佳。 |
| **后端** | Python (FastAPI) + Pandas | FastAPI性能高且易于开发；Pandas处理Excel数据最强；原生支持LLM生态。 |
| **数据库** | DuckDB (OLAP) | 专为数据分析设计的嵌入式数据库，处理聚合计算（Sum/Group By）速度极快，且无需单独部署服务。 |
| **AI模块** | OpenAI SDK (Adapter Mode) | 通过统一SDK适配器模式，兼容 OpenAI、Kimi、Qwen、GLM 等主流模型 API。 |
| **导出** | Puppeteer (Headless Chrome) | 唯一能保证前端图表（Canvas/SVG）“所见即所得”且高清导出为PDF的技术方案。 |

## 开发阶段

### 阶段1：基础设施与数据核心 (Infrastructure & Data Core) - [预计10天]

**目标**：完成开发环境搭建，实现Excel上传、智能清洗与入库，跑通基础API。

| 任务 | 状态 | 产出 |
|-----|------|------|
| **环境搭建**：初始化 Monorepo，配置 Docker (含 Chrome 依赖) 与 DuckDB 持久化 | ⬜ | Docker-Compose 运行环境 |
| **后端开发**：实现 Excel 解析、Hash 校验与 Levenshtein 模糊匹配算法 | ⬜ | `/api/upload` & `/api/mapping` 接口 |
| **前端开发**：上传组件与字段映射确认 Modal (交互逻辑) | ⬜ | 可用的数据导入页面 |
| **ETL逻辑**：清洗数据，提取期间(Period)，聚合计算并存入 DuckDB | ⬜ | 数据库 Schema 与基础数据表 |

### 阶段2：可视化与业务交互 (Visualization & Interaction) - [预计14天]

**目标**：完成所有 Dashboard 页面开发，还原 UI 规范，实现核心图表交互。
**依赖**：阶段1 数据接口

| 任务 | 状态 | 产出 |
|-----|------|------|
| **全局仪表盘**：KPI 卡片组件、**机会矩阵 (气泡图)** 开发与交互 | ⬜ | Global Dashboard 页面 |
| **品类详情页**：供应商集中度 (CR5) 图表、Top 榜单 (双轴图) | ⬜ | Commodity Detail 页面 |
| **供应商详情页**：画像展示、**动态模拟沙箱 (What-If)** 前端逻辑 | ⬜ | Supplier Detail 页面 |
| **样式打磨**：应用 Nexteer UI 规范 (Roboto Mono 字体、红黑配色) | ⬜ | 符合 UI 规范的系统界面 |

### 阶段3：智能分析与导出交付 (AI & Export) - [预计10天]

**目标**：集成 LLM 能力，实现流式报告生成，并开发高清 PDF 导出功能。
**依赖**：阶段2 页面统计数据

| 任务 | 状态 | 产出 |
|-----|------|------|
| **LLM 后端适配**：封装 OpenAI 兼容客户端，实现 Prompt 注入与数据脱敏 | ⬜ | 通用 LLM 接口服务 |
| **AI 前端交互**：配置页 (API Key/URL)、流式 Markdown 渲染组件 | ⬜ | 智能分析模块 |
| **导出服务**：集成 Puppeteer，实现服务端截图与 PDF 合成 | ⬜ | `/api/export` 接口与下载功能 |

### 阶段4：测试、部署与交付 - [预计5天]

| 任务 | 状态 |
|-----|------|
| **功能测试**：Excel 容错测试、大数据量(5w+)性能测试 | ⬜ |
| **部署实施**：阿里云 ECS 环境配置、Docker 镜像构建与发布 | ⬜ |
| **文档交付**：API 文档、部署手册、用户操作指南 | ⬜ |

## 里程碑

| 里程碑 | 日期 | 标准 |
|-------|------|------|
| **M1 数据跑通** | T+10天 | 本地 Docker 可运行，支持 Excel 上传并存入数据库，字段映射准确。 |
| **M2 可视化完成** | T+24天 | 所有图表可见，交互流畅，模拟沙箱可用，UI 还原度 95% 以上。 |
| **M3 系统上线** | T+39天 | AI 报告生成顺畅，导出功能正常，阿里云环境部署完毕。 |

## 风险

| 风险 | 可能性 | 应对 |
|-----|-------|------|
| **导出字体乱码** | 高 | Docker 镜像构建时强制 COPY 本地字体文件 (Montserrat/Roboto) 至容器系统目录。 |
| **LLM 网络超时** | 中 | 后端设置合理的 Requests Timeout，前端采用 SSE 流式接收避免假死；服务器配置 API Proxy。 |
| **数据格式异常** | 中 | 使用 `openpyxl` 的 `data_only` 模式读取数值；前端增加强校验与详细报错提示。 |

---
**状态图例**：⬜未开始 🔄进行中 ✅已完成